<app-page-header 
  [pageTitle]="pageTitle" 
  [backRoute]="backRoute">
</app-page-header>

<div class="sales-plan-container">
  <div class="form-container">
    <form [formGroup]="salesPlanForm" (ngSubmit)="createSalesPlan()">
      
      <!-- Selector de Producto -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ 'product_label' | translate }}</mat-label>
        <mat-select 
          formControlName="product" 
          (blur)="validateField('product')"
          required>
          <mat-option 
            *ngFor="let product of products" 
            [value]="product.id">
            {{ product.name }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="getErrorMessage('product')">
          {{ getErrorMessage('product') }}
        </mat-error>
      </mat-form-field>

      <!-- Selector de Región -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ 'region_label' | translate }}</mat-label>
        <mat-select 
          formControlName="region" 
          (blur)="validateField('region')"
          required>
          <mat-option 
            *ngFor="let region of regionOptions" 
            [value]="region.value">
            {{ region.labelKey | translate }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="getErrorMessage('region')">
          {{ getErrorMessage('region') }}
        </mat-error>
      </mat-form-field>

      <!-- Selector de Período -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ 'period_label' | translate }}</mat-label>
        <mat-select 
          formControlName="quarter" 
          (blur)="validateField('quarter')"
          required>
          <mat-option 
            *ngFor="let quarter of quarterOptions" 
            [value]="quarter.value">
            {{ quarter.labelKey | translate }}
          </mat-option>
        </mat-select>
        <mat-error *ngIf="getErrorMessage('quarter')">
          {{ getErrorMessage('quarter') }}
        </mat-error>
      </mat-form-field>

      <!-- Campo Meta -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>{{ 'goal_label' | translate }}</mat-label>
        <input 
          matInput 
          type="text" 
          formControlName="totalGoal"
          (input)="onTotalGoalChange($event.target.value)"
          (blur)="validateField('totalGoal')"
          placeholder="$1.000.000"
          required>
        <mat-error *ngIf="getErrorMessage('totalGoal')">
          {{ getErrorMessage('totalGoal') }}
        </mat-error>
      </mat-form-field>

      <!-- Botón Crear Plan -->
      <div class="action-buttons">
        <button 
          mat-raised-button 
          type="submit"
          [disabled]="!isFormValid() || saveStatus() === 'saving'"
          class="create-button">
          {{ 'create_plan_button' | translate }}
        </button>
      </div>

      <!-- Mensajes de Estado -->
      <div class="status-messages" *ngIf="saveStatus() !== 'idle'">
        <div *ngIf="saveStatus() === 'saving'" class="saving-message">
          <mat-icon>hourglass_empty</mat-icon>
          {{ 'saving_plan' | translate }}
        </div>
        
        <div *ngIf="saveStatus() === 'success'" class="success-message">
          <mat-icon>check_circle</mat-icon>
          {{ 'plan_created_success' | translate }}
        </div>
        
        <div *ngIf="saveStatus() === 'error'" class="error-message">
          <mat-icon>error</mat-icon>
          {{ 'plan_creation_error' | translate }}
        </div>
      </div>
    </form>
  </div>
</div>
